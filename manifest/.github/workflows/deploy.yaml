name: CI_JavaFX_Pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  JFX_VERSION: 21.0.10
  APP_NAME: HelloWorldFx

jobs:
  package-linux:
    runs-on: ubuntu-latest
    
    steps:
      - name: '1. Sincronizar Repositorio'
        uses: actions/checkout@v4

      - name: '2. Configurar Entorno Java'
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'adopt' 
      - name: '3. Preparar Dependencias JavaFX'
        run: |
          echo "Obteniendo SDK de Gluon..."
          curl -L https://download2.gluonhq.com/openjfx/${{ env.JFX_VERSION }}/openjfx-${{ env.JFX_VERSION }}_linux-x64_bin-sdk.zip -o jfx-sdk.zip
          unzip -q jfx-sdk.zip -d sdk-dir

      - name: '4. Fase de Compilaci√≥n'
        run: |
          mkdir -p out
          javac --module-path sdk-dir/javafx-sdk-${{ env.JFX_VERSION }}/lib \
                --add-modules javafx.controls \
                -d out src/dam/optativa/HelloWorldFx.java

      - name: '5. Empaquetado (JAR y DEB)'
        run: |
          # Generar el ejecutable Java
          jar --create --file=out/${{ env.APP_NAME }}.jar --manifest=manifest/MANIFEST.MF -C out .
          
          # Crear el instalador para Debian/Ubuntu
          jpackage --type deb \
            --dest dist/ \
            --name ${{ env.APP_NAME }} \
            --input out/ \
            --main-jar ${{ env.APP_NAME }}.jar \
            --main-class dam.optativa.HelloWorldFx \
            --module-path sdk-dir/javafx-sdk-${{ env.JFX_VERSION }}/lib \
            --add-modules javafx.controls

      - name: '6. Subir Instalador'
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.APP_NAME }}-installer
          path: dist/*.deb